async function decompress(str) {
  const u8 = Uint8Array.from(atob(str), (c) => c.charCodeAt(0));
  const cs = new DecompressionStream("gzip");
  const writer = cs.writable.getWriter();
  writer.write(u8);
  writer.close();
  return new Response(cs.readable).arrayBuffer().then(function (arrayBuffer) {
    return new TextDecoder().decode(arrayBuffer);
  });
}

async function compress(string, encoding) {
  const byteArray = new TextEncoder().encode(string);
  const cs = new CompressionStream(encoding);
  const writer = cs.writable.getWriter();
  writer.write(byteArray);
  writer.close();
  const ab = await (new Response(cs.readable).arrayBuffer());
  const u8 = new Uint8Array(ab);
  return btoa(String.fromCharCode(...u8));
}
